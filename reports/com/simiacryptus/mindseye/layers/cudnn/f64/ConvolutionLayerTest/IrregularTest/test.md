# ConvolutionLayer
## IrregularTest
### Json Serialization
Code from [LayerTestBase.java:83](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L83) executed in 0.00 seconds: 
```java
    JsonObject json = layer.getJson();
    NNLayer echo = NNLayer.fromJson(json);
    assert (echo != null) : "Failed to deserialize";
    assert (layer != echo) : "Serialization did not copy";
    Assert.assertEquals("Serialization not equal", layer, echo);
    return new GsonBuilder().setPrettyPrinting().create().toJson(json);
```

Returns: 

```
    {
      "class": "com.simiacryptus.mindseye.layers.cudnn.f64.ConvolutionLayer",
      "id": "a864e734-2f23-44db-97c1-5040000014ca",
      "isFrozen": false,
      "name": "ConvolutionLayer/a864e734-2f23-44db-97c1-5040000014ca",
      "filter": {
        "dimensions": [
          3,
          3,
          18
        ],
        "data": [
          -0.996,
          -0.94,
          -0.976,
          0.088,
          -0.176,
          -0.38,
          -1.788,
          -1.052,
          -1.884,
          -1.208,
          -1.98,
          1.152,
          1.304,
          -1.216,
          1.336,
          1.064,
          0.068,
          1.676,
          -0.568,
          -0.928,
          -0.52,
          0.584,
          0.224,
          -0.024,
          -1.204,
          1.948,
          -1.676,
          1.436,
          -0.22,
          -0.392,
          0.432,
          0.768,
          -0.992,
          1.832,
          -0.34,
          -0.496,
          -1.416,
          -0.636,
          -1.824,
          -1.132,
          -1.28,
          -1.6,
          -1.528,
          0.88,
          -0.064,
          -1.752,
          -0.024,
          1.764,
          0.812,
          -0.96,
          -1.736,
          1.164,
          0.296,
          1.156,
          -1.292,
          -1.952,
          -1.932,
          0.576,
          -1.568,
          1.712,
          -0.852,
          0.952,
          0.884,
          -0.248,
          -1.124,
          -0.272,
          0.848,
          1.884,
          -0.696,
          1.976,
          0.736,
          -1.592,
          -0.004,
          0.324,
          0.392,
          -0.464,
          1.132,
          -1.032,
          1.684,
          -0.572,
          1.164,
          -1.536,
          -0.008,
          1.84,
          -1.38,
          0.832,
          0.0,
          -1.628,
          1.336,
          -1.42,
          -0.212,
          0.416,
          0.492,
          -0.02,
          0.048,
          0.652,
          1.576,
          -1.408,
          -0.324,
          -1.772,
          -1.692,
          -1.336,
          -0.308,
          -1.964,
          0.668,
          0.224,
          0.468,
          1.012,
          0.84,
          -0.02,
          -0.988,
          -0.664,
          0.852,
          -0.168,
          1.168,
          -0.392,
          1.112,
          0.172,
          0.412,
          1.832,
          0.796,
          -0.724,
          0.492,
          -1.128,
          0.22,
          1.312,
          0.676,
          1.308,
          1.088,
          -1.424,
          -1.172,
          -1.504,
          -1.076,
          1.692,
          1.976,
          -1.0,
          -1.948,
          0.824,
          0.684,
          -0.768,
          1.02,
          -1.188,
          -1.104,
          -1.388,
          1.924,
          -1.972,
          -1.556,
          1.992,
          0.16,
          1.228,
          1.396,
          0.12,
          0.912,
          1.44,
          -0.84,
          0.264,
          1.924,
          1.324,
          -1.652,
          0.68,
          1.752,
          -1.164
        ]
      },
      "strideX": 1,
      "strideY": 1
    }
```



### Example Input/Output Pair
Code from [LayerTestBase.java:120](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L120) executed in 0.00 seconds: 
```java
    SimpleEval eval = SimpleEval.run(layer, inputPrototype);
    return String.format("--------------------\nInput: \n[%s]\n--------------------\nOutput: \n%s",
      Arrays.stream(inputPrototype).map(t->t.prettyPrint()).reduce((a,b)->a+",\n"+b).get(),
      eval.getOutput().prettyPrint());
```

Returns: 

```
    --------------------
    Input: 
    [[
    	[ [ -1.66, -1.156, -1.08 ], [ -0.748, -1.228, -1.96 ], [ -1.42, -1.232, -0.144 ], [ 1.876, 1.34, -1.744 ], [ 1.964, -1.588, 0.208 ] ],
    	[ [ 0.488, 0.524, -0.14 ], [ -0.324, 0.208, -1.92 ], [ 0.64, 1.716, 1.584 ], [ 1.176, 0.12, -1.76 ], [ 0.344, -1.576, 0.148 ] ],
    	[ [ 0.136, 0.728, -1.988 ], [ -1.38, 1.36, 0.068 ], [ -1.832, 1.132, 0.968 ], [ -1.72, -1.264, 1.996 ], [ 0.528, -0.576, 1.784 ] ],
    	[ [ 1.308, -1.8, -0.12 ], [ -1.68, 0.632, -0.588 ], [ -1.708, 1.068, 1.588 ], [ -1.348, 0.04, -1.232 ], [ 1.076, -0.08, -1.396 ] ],
    	[ [ -1.92, 0.736, 0.104 ], [ 0.728, -1.376, -0.9 ], [ 0.34, 1.596, -1.6 ], [ -1.012, -0.252, 1.388 ], [ -0.052, 0.324, -1.088 ] ]
    ]]
    --------------------
    Output: 
    [
    	[ [ 3.2028799999999995, 3.6552, -3.5555839999999996, 3.112416, 1.6053439999999997, 3.5759680000000005 ], [ 3.558656000000001, 1.962704, 0.6641600000000003, -4.109568, -0.5030080000000001, -5.462208 ], [ -6.551312, -3.7856160000000005, -10.932863999999999, 5.351471999999999, 0.8366720000000011, -4.889952 ], [ 0.11259200000000018, 0.9729759999999997, 3.0740319999999994, 0.4686560000000005, -5.238144, -3.3846399999999988 ], [ -2.9290719999999997, -2.09688, -0.26299200000000034, 9.57984, -7.129823999999999, 0.884144 ] ],
    	[ [ 4.208144, -5.397392000000001, 2.7524319999999993, -4.752496, 5.510912, -0.5498720000000006 ], [ -3.9167359999999993, 0.32073599999999997, 11.853359999999999, -6.613072, 0.7198559999999972, -5.598448000000001 ], [ -1.305696, -3.3325440000000013, -8.761872, 3.7304959999999996, 16.252336000000003, 6.008224 ], [ 8.394575999999999, 3.341839999999999, 5.928479999999999, -6.30072, 1.4815520000000018, 10.323504000000002 ], [ -0.671616, -6.1184, -10.558048000000001, -2.8272000000000013, 0.48539199999999993, 4.133184 ] ],
    	[ [ -2.1508, 2.003663999999999, 5.138031999999999, 0.8696799999999996, 3.351776, -5.777392 ], [ -5.007759999999998, 6.421712000000002, 2.353392, 1.2198399999999994, -3.432096000000002, -0.9233119999999999 ], [ 9.028288, 6.848575999999998, -9.575872, -5.975295999999999, 4.307440000000004, 2.2488000000000015 ], [ 14.473024000000002, -4.062496, 2.377424, -22.423552, -8.084879999999998, 4.3534880000000005 ], [ -2.8537119999999994, -2.268368, -0.11900799999999957, -4.703104, -6.62224, 2.8323840000000002 ] ],
    	[ [ 3.510688, -8.149008, 0.32355200000000056, 4.330752000000001, 1.5024639999999994, -0.8322240000000007 ], [ -6.035456000000001, -4.4299040000000005, 10.582320000000001, -2.665616000000001, 5.420944000000001, -10.704800000000004 ], [ 15.620736, 1.266176, -0.9653919999999994, 3.6137759999999997, 3.3490879999999974, 3.4849279999999996 ], [ -3.266720000000001, 5.691648, 4.012928000000001, 5.885968, 3.328528, 2.101984 ], [ 8.091808, -0.8488319999999986, 0.9765919999999996, 0.570832, 1.2874079999999994, -17.628176 ] ],
    	[ [ -1.2667680000000006, 3.1372000000000004, 0.470864, 0.5789599999999999, 4.125376, -3.6358400000000004 ], [ -3.795664, -2.9404959999999973, -7.433680000000001, 11.739744000000002, 3.6855680000000004, -0.4746400000000009 ], [ 3.503055999999999, -5.208543999999999, 5.429568000000001, 2.8992959999999997, 8.79824, -10.61936 ], [ 10.182096, -6.323264, 0.6115680000000004, -0.6537919999999994, 3.7304800000000005, 5.011936000000001 ], [ -0.2515360000000002, -1.620496, 4.179215999999999, -0.6292160000000001, -4.999472, 0.28841599999999923 ] ]
    ]
```



### Reference Implementation
Code from [LayerTestBase.java:131](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L131) executed in 0.02 seconds: 
```java
    System.out.println(new GsonBuilder().setPrettyPrinting().create().toJson(referenceLayer.getJson()));
    getEquivalencyTester().test(referenceLayer, layer, inputPrototype);
```
Logging: 
```
    {
      "class": "com.simiacryptus.mindseye.layers.aparapi.ConvolutionLayer",
      "id": "a864e734-2f23-44db-97c1-5040000014d3",
      "isFrozen": false,
      "name": "ConvolutionLayer/a864e734-2f23-44db-97c1-5040000014d3",
      "filter": {
        "dimensions": [
          3,
          3,
          18
        ],
        "data": [
          -0.996,
          -0.94,
          -0.976,
          0.088,
          -0.176,
          -0.38,
          -1.788,
          -1.052,
          -1.884,
          -1.208,
          -1.98,
          1.152,
          1.304,
          -1.216,
          1.336,
          1.064,
          0.068,
          1.676,
          -0.568,
          -0.928,
          -0.52,
          0.584,
          0.224,
          -0.024,
          -1.204,
          1.948,
          -1.676,
          1.436,
          -0.22,
          -0.392,
          0.432,
          0.768,
          -0.992,
          1.832,
          -0.34,
          -0.496,
          -1.416,
          -0.636,
          -1.824,
          -1.132,
          -1.28,
          -1.6,
          -1.528,
          0.88,
          -0.064,
          -1.752,
          -0.024,
          1.764,
          0.812,
          -0.96,
          -1.736,
          1.164,
          0.296,
          1.156,
          -1.292,
          -1.952,
          -1.932,
          0.576,
          -1.568,
          1.712,
          -0.852,
          0.952,
          0.884,
          -0.248,
          -1.124,
          -0.272,
          0.848,
          1.884,
          -0.696,
          1.976,
          0.736,
          -1.592,
          -0.004,
          0.324,
          0.392,
          -0.464,
          1.132,
          -1.032,
          1.684,
          -0.572,
          1.164,
          -1.536,
          -0.008,
          1.84,
          -1.38,
          0.832,
          0.0,
          -1.628,
          1.336,
          -1.42,
          -0.212,
          0.416,
          0.492,
          -0.02,
          0.048,
          0.652,
          1.576,
          -1.408,
          -0.324,
          -1.772,
          -1.692,
          -1.336,
          -0.308,
          -1.964,
          0.668,
          0.224,
          0.468,
          1.012,
          0.84,
          -0.02,
          -0.988,
          -0.664,
          0.852,
          -0.168,
          1.168,
          -0.392,
          1.112,
          0.172,
          0.412,
          1.832,
          0.796,
          -0.724,
          0.492,
          -1.128,
          0.22,
          1.312,
          0.676,
          1.308,
          1.088,
          -1.424,
          -1.172,
      
```
...[skipping 165 bytes](etc/1.txt)...
```
    1.388,
          1.924,
          -1.972,
          -1.556,
          1.992,
          0.16,
          1.228,
          1.396,
          0.12,
          0.912,
          1.44,
          -0.84,
          0.264,
          1.924,
          1.324,
          -1.652,
          0.68,
          1.752,
          -1.164
        ]
      },
      "skip": {
        "dimensions": [
          1,
          1
        ]
      },
      "simple": true
    }
    Inputs: [
    	[ [ -1.66, -1.156, -1.08 ], [ -0.748, -1.228, -1.96 ], [ -1.42, -1.232, -0.144 ], [ 1.876, 1.34, -1.744 ], [ 1.964, -1.588, 0.208 ] ],
    	[ [ 0.488, 0.524, -0.14 ], [ -0.324, 0.208, -1.92 ], [ 0.64, 1.716, 1.584 ], [ 1.176, 0.12, -1.76 ], [ 0.344, -1.576, 0.148 ] ],
    	[ [ 0.136, 0.728, -1.988 ], [ -1.38, 1.36, 0.068 ], [ -1.832, 1.132, 0.968 ], [ -1.72, -1.264, 1.996 ], [ 0.528, -0.576, 1.784 ] ],
    	[ [ 1.308, -1.8, -0.12 ], [ -1.68, 0.632, -0.588 ], [ -1.708, 1.068, 1.588 ], [ -1.348, 0.04, -1.232 ], [ 1.076, -0.08, -1.396 ] ],
    	[ [ -1.92, 0.736, 0.104 ], [ 0.728, -1.376, -0.9 ], [ 0.34, 1.596, -1.6 ], [ -1.012, -0.252, 1.388 ], [ -0.052, 0.324, -1.088 ] ]
    ]
    Error: [
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ] ]
    ]
    Accuracy:
    absoluteTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (150#)
    relativeTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (150#)
    
```

### Batch Execution
Code from [LayerTestBase.java:138](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L138) executed in 0.04 seconds: 
```java
    BatchingTester batchingTester = getBatchingTester();
    return batchingTester==null?null:batchingTester.test(layer, inputPrototype);
```

Returns: 

```
    ToleranceStatistics{absoluteTol=1.7171e-17 +- 1.5259e-16 [0.0000e+00 - 3.5527e-15] (2250#), relativeTol=1.4970e-18 +- 1.2289e-17 [0.0000e+00 - 1.4532e-16] (2250#)}
```



### Differential Validation
Code from [LayerTestBase.java:144](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L144) executed in 2.01 seconds: 
```java
    return getDerivativeTester().test(layer, inputPrototype);
```
Logging: 
```
    Inputs: [
    	[ [ -1.66, -1.156, -1.08 ], [ -0.748, -1.228, -1.96 ], [ -1.42, -1.232, -0.144 ], [ 1.876, 1.34, -1.744 ], [ 1.964, -1.588, 0.208 ] ],
    	[ [ 0.488, 0.524, -0.14 ], [ -0.324, 0.208, -1.92 ], [ 0.64, 1.716, 1.584 ], [ 1.176, 0.12, -1.76 ], [ 0.344, -1.576, 0.148 ] ],
    	[ [ 0.136, 0.728, -1.988 ], [ -1.38, 1.36, 0.068 ], [ -1.832, 1.132, 0.968 ], [ -1.72, -1.264, 1.996 ], [ 0.528, -0.576, 1.784 ] ],
    	[ [ 1.308, -1.8, -0.12 ], [ -1.68, 0.632, -0.588 ], [ -1.708, 1.068, 1.588 ], [ -1.348, 0.04, -1.232 ], [ 1.076, -0.08, -1.396 ] ],
    	[ [ -1.92, 0.736, 0.104 ], [ 0.728, -1.376, -0.9 ], [ 0.34, 1.596, -1.6 ], [ -1.012, -0.252, 1.388 ], [ -0.052, 0.324, -1.088 ] ]
    ]
    Inputs Statistics: {meanExponent=-0.1307890544450964, negative=39, min=-1.088, max=-1.088, mean=-0.19503999999999996, count=75.0, positive=36, stdDev=1.2040340796948676, zeros=0}
    Output: [
    	[ [ 3.2028799999999995, 3.6552, -3.5555839999999996, 3.112416, 1.6053439999999997, 3.5759680000000005 ], [ 3.558656000000001, 1.962704, 0.6641600000000003, -4.109568, -0.5030080000000001, -5.462208 ], [ -6.551312, -3.7856160000000005, -10.932863999999999, 5.351471999999999, 0.8366720000000011, -4.889952 ], [ 0.11259200000000018, 0.9729759999999997, 3.0740319999999994, 0.4686560000000005, -5.238144, -3.3846399999999988 ], [ -2.9290719999999997, -2.09688, -0.26299200000000034, 9.57984, -7.129823999999999, 0.884144 ] ],
    	[ [ 4.208144, -5.397392000000001, 2.7524319999999993, -4.752496, 5.510912, -0.5498720000000006 ], [ -3.9167359999999993, 0.32073599999999997, 11.853359999999999, -6.613072, 0.7198559999999972, -5.598448000000001 ], [ -1.305696, -3.3325440000000013, -8.761872, 3.7304959999999996, 16.252336000000003, 6.008224 ], [ 8.394575999999999, 3.341839999999999, 5.928479999999999, -6.30072, 1.4815520000000018, 10.323504000000002 ], [ -0.671616, -6.1184, -10.558048000000001, -2.8272000000000013, 0.48539199999999993, 4.133184 ] ],
    	[ [ -2.1508, 2.003663999999999, 5.138031999999999, 0.8696799999999996, 3.351776, -5.777392 ], [ -5.007759999999998, 6.421712000000002,
```
...[skipping 7705 bytes](etc/2.txt)...
```
    0.0, -1.660000000001105, 0.4880000000007101, 0.1359999999905881, ... ], ... ]
    Measured Statistics: {meanExponent=-0.11904043723642782, negative=1536, min=-1.2319999999998998, max=-1.2319999999998998, mean=-0.020921481481512304, count=24300.0, positive=1506, stdDev=0.43601390877999274, zeros=21258}
    Gradient Error: [ [ -2.6554869414496807E-12, 2.5055513219740533E-12, 5.402345237826012E-13, -1.2703171847761041E-12, 0.0, 6.400435736964027E-13, -3.830491479561715E-12, -1.1367129459927128E-11, ... ], [ -1.52522439123004E-12, -2.6554869414496807E-12, -1.935340776526573E-12, 4.981126622283227E-12, -1.2703171847761041E-12, -3.085531830038235E-12, -8.24174062330485E-12, -3.830491479561715E-12, ... ], [ 0.0, -1.52522439123004E-12, -2.6554869414496807E-12, 2.5055513219740533E-12, 5.402345237826012E-13, 0.0, -3.085531830038235E-12, 6.400435736964027E-13, ... ], [ -8.171685550451002E-12, -5.301314942585122E-13, -1.3522516439934407E-13, -1.9202417433916708E-12, 0.0, -2.6554869414496807E-12, -6.376232875027199E-12, -3.900657574718025E-12, ... ], [ -1.1051159987118808E-12, 7.100986465502501E-13, -5.301314942585122E-13, -1.3522516439934407E-13, 2.5206503551089554E-12, -1.52522439123004E-12, -2.6554869414496807E-12, -1.525801707202845E-11, ... ], [ 0.0, -1.1051159987118808E-12, -3.730793451950376E-12, -5.301314942585122E-13, -1.3522516439934407E-13, 0.0, -1.52522439123004E-12, -2.6554869414496807E-12, ... ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 7.100986465502501E-13, -5.301314942585122E-13, -9.017009361400596E-12, ... ], [ 0.0, 0.0, 0.0, 0.0, 0.0, -1.1051159987118808E-12, 7.100986465502501E-13, -9.411915691259765E-12, ... ], ... ]
    Error Statistics: {meanExponent=-11.66248952357655, negative=1559, min=1.0014211682118912E-13, max=1.0014211682118912E-13, mean=-3.0903704949436554E-14, count=24300.0, positive=1483, stdDev=1.8869312455542017E-12, zeros=21258}
    Finite-Difference Derivative Accuracy:
    absoluteTol: 6.1581e-13 +- 2.0826e-12 [0.0000e+00 - 3.3197e-11] (35550#)
    relativeTol: 7.6524e-12 +- 4.3728e-11 [2.5689e-15 - 1.4022e-09] (6064#)
    
```

Returns: 

```
    ToleranceStatistics{absoluteTol=6.1581e-13 +- 2.0826e-12 [0.0000e+00 - 3.3197e-11] (35550#), relativeTol=7.6524e-12 +- 4.3728e-11 [2.5689e-15 - 1.4022e-09] (6064#)}
```



### Performance
Code from [LayerTestBase.java:149](../../../../../../../../../src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L149) executed in 0.64 seconds: 
```java
    getPerformanceTester().test(layer, inputPrototype);
```
Logging: 
```
    Evaluation performance: 23.4202 +- 5.1699 [17.1415 - 34.6506]
    Learning performance: 13.9839 +- 18.3755 [9.1022 - 194.4154]
    
```

