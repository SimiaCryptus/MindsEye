# ConvolutionLayer
## ConvolutionLayerTest
### Json Serialization
Code from [LayerTestBase.java:84](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L84) executed in 0.00 seconds: 
```java
    JsonObject json = layer.getJson();
    NNLayer echo = NNLayer.fromJson(json);
    assert (echo != null) : "Failed to deserialize";
    assert (layer != echo) : "Serialization did not copy";
    Assert.assertEquals("Serialization not equal", layer, echo);
    return new GsonBuilder().setPrettyPrinting().create().toJson(json);
```

Returns: 

```
    {
      "class": "com.simiacryptus.mindseye.layers.cudnn.f64.ConvolutionLayer",
      "id": "c88cbdf1-1c2a-4a5e-b964-8909000002fe",
      "isFrozen": false,
      "name": "ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-8909000002fe",
      "filter": {
        "dimensions": [
          1,
          1,
          4
        ],
        "data": [
          0.704,
          0.14,
          -1.304,
          0.672
        ]
      },
      "strideX": 1,
      "strideY": 1
    }
```



### Example Input/Output Pair
Code from [LayerTestBase.java:121](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L121) executed in 0.00 seconds: 
```java
    SimpleEval eval = SimpleEval.run(layer, inputPrototype);
    return String.format("--------------------\nInput: \n[%s]\n--------------------\nOutput: \n%s",
      Arrays.stream(inputPrototype).map(t->t.prettyPrint()).reduce((a,b)->a+",\n"+b).get(),
      eval.getOutput().prettyPrint());
```

Returns: 

```
    --------------------
    Input: 
    [[
    	[ [ -0.42, 1.864 ], [ -0.04, 0.564 ], [ 1.244, -0.356 ] ],
    	[ [ -0.88, 1.164 ], [ -0.94, 0.036 ], [ 0.312, 1.852 ] ],
    	[ [ -1.524, -1.492 ], [ 0.572, 1.704 ], [ 0.668, 0.456 ] ]
    ]]
    --------------------
    Output: 
    [
    	[ [ -2.7263360000000003, 1.1938080000000002 ], [ -0.763616, 0.37340799999999996 ], [ 1.34, -0.06507199999999999 ] ],
    	[ [ -2.1373759999999997, 0.6590079999999999 ], [ -0.7087039999999999, -0.10740799999999999 ], [ -2.1953600000000004, 1.288224 ] ],
    	[ [ 0.8726720000000002, -1.2159840000000002 ], [ -1.819328, 1.225168 ], [ -0.12435200000000002, 0.39995200000000003 ] ]
    ]
```



### Reference Implementation
Code from [LayerTestBase.java:132](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L132) executed in 0.01 seconds: 
```java
    System.out.println(new GsonBuilder().setPrettyPrinting().create().toJson(referenceLayer.getJson()));
    getEquivalencyTester().test(referenceLayer, layer, inputPrototype);
```
Logging: 
```
    {
      "class": "com.simiacryptus.mindseye.layers.aparapi.ConvolutionLayer",
      "id": "c88cbdf1-1c2a-4a5e-b964-890900000305",
      "isFrozen": false,
      "name": "ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-890900000305",
      "filter": {
        "dimensions": [
          1,
          1,
          4
        ],
        "data": [
          0.704,
          0.14,
          -1.304,
          0.672
        ]
      },
      "skip": {
        "dimensions": [
          1,
          1
        ]
      },
      "simple": true
    }
    Inputs: [
    	[ [ -0.42, 1.864 ], [ -0.04, 0.564 ], [ 1.244, -0.356 ] ],
    	[ [ -0.88, 1.164 ], [ -0.94, 0.036 ], [ 0.312, 1.852 ] ],
    	[ [ -1.524, -1.492 ], [ 0.572, 1.704 ], [ 0.668, 0.456 ] ]
    ]
    Error: [
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ]
    ]
    Accuracy:
    absoluteTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (18#)
    relativeTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (18#)
    
```

### Differential Validation
Code from [LayerTestBase.java:139](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L139) executed in 0.08 seconds: 
```java
    getDerivativeTester().test(layer, inputPrototype);
```
Logging: 
```
    Component: ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-8909000002fe
    Inputs: [
    	[ [ -0.42, 1.864 ], [ -0.04, 0.564 ], [ 1.244, -0.356 ] ],
    	[ [ -0.88, 1.164 ], [ -0.94, 0.036 ], [ 0.312, 1.852 ] ],
    	[ [ -1.524, -1.492 ], [ 0.572, 1.704 ], [ 0.668, 0.456 ] ]
    ]
    output=[
    	[ [ -2.7263360000000003, 1.1938080000000002 ], [ -0.763616, 0.37340799999999996 ], [ 1.34, -0.06507199999999999 ] ],
    	[ [ -2.1373759999999997, 0.6590079999999999 ], [ -0.7087039999999999, -0.10740799999999999 ], [ -2.1953600000000004, 1.288224 ] ],
    	[ [ 0.8726720000000002, -1.2159840000000002 ], [ -1.819328, 1.225168 ], [ -0.12435200000000002, 0.39995200000000003 ] ]
    ]
    measured/actual: [ [ 0.7040000000024804, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1399999999995849 ], [ 0.0, 0.7039999999980395, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.7039999999980395, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.70400000000026, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.70400000000026, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.70400000000026, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.7039999999980395, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.7040000000024804, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.7039999999997049, 0.0 ], [ -1.3039999999975294, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.6719999999993398 ] ]
    implemented/expected: [ [ 0.704, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.14 ], [ 0.0, 0.704, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.704, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.704, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.704, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.704, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.704, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.704, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.704, 0.0 ], [ -1.304, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.672 ] ]
    error: [ [ 2.4804602816175247E-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -4.15112
```
...[skipping 923 bytes](etc/1.txt)...
```
    72, 1.704 ], [ 0.668, 0.456 ] ]
    ]
    Outputs: [
    	[ [ -2.7263360000000003, 1.1938080000000002 ], [ -0.763616, 0.37340799999999996 ], [ 1.34, -0.06507199999999999 ] ],
    	[ [ -2.1373759999999997, 0.6590079999999999 ], [ -0.7087039999999999, -0.10740799999999999 ], [ -2.1953600000000004, 1.288224 ] ],
    	[ [ 0.8726720000000002, -1.2159840000000002 ], [ -1.819328, 1.225168 ], [ -0.12435200000000002, 0.39995200000000003 ] ]
    ]
    Measured Gradient: [ [ -0.42000000000097515, -0.8800000000031005, -1.5240000000016352, -0.040000000000040004, -0.940000000000385, 0.5719999999986847, 1.2439999999980245, 0.31200000000009, 0.6679999999997799, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.42000000000097515 ], [ 1.8640000000003099, 1.163999999995724, -1.4919999999996048, 0.5639999999995648, 0.03599999999992498, 1.7040000000001498, -0.35600000000135523, 1.8520000000021852, 0.4559999999999287, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.8639999999980894 ] ]
    Implemented Gradient: [ [ -0.42, -0.88, -1.524, -0.04, -0.94, 0.572, 1.244, 0.312, 0.668, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.42 ], [ 1.864, 1.164, -1.492, 0.564, 0.036, 1.704, -0.356, 1.852, 0.456, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.864 ] ]
    Error: [ [ -9.751643936795062E-13, -3.1005198408706747E-12, -1.6351364706679306E-12, -4.000272335602517E-14, -3.850253449400043E-13, -1.315281217273423E-12, -1.9755308500180035E-12, 8.998357614586894E-14, -2.2015722578316854E-13, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -9.751643936795062E-13 ], [ 3.097522238704187E-13, -4.275912957041328E-12, 3.9523939676655573E-13, -4.3509640335059885E-13, -7.501638199514105E-14, 1.4988010832439613E-13, -1.3552492461599286E-12, 2.185140957067233E-12, -7.133182933216631E-14, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.9106938253798944E-12 ] ]
    Finite-Difference Derivative Accuracy:
    absoluteTol: 1.4704e-13 +- 4.9873e-13 [0.0000e+00 - 4.2759e-12] (396#)
    relativeTol: 8.3714e-13 +- 1.3076e-12 [9.5316e-15 - 6.4476e-12] (72#)
    
```

### Performance
Code from [LayerTestBase.java:144](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L144) executed in 0.19 seconds: 
```java
    getPerformanceTester().test(layer, inputPrototype);
```
Logging: 
```
    Evaluation performance: 6.7159 +- 1.4733 [5.3519 - 13.6875]
    Learning performance: 5.3581 +- 0.3946 [4.8133 - 7.0532]
    
```

