# ConvolutionLayer
## ConvolutionLayerTest
### Json Serialization
Code from [LayerTestBase.java:84](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L84) executed in 0.00 seconds: 
```java
    JsonObject json = layer.getJson();
    NNLayer echo = NNLayer.fromJson(json);
    assert (echo != null) : "Failed to deserialize";
    assert (layer != echo) : "Serialization did not copy";
    Assert.assertEquals("Serialization not equal", layer, echo);
    return new GsonBuilder().setPrettyPrinting().create().toJson(json);
```

Returns: 

```
    {
      "class": "com.simiacryptus.mindseye.layers.cudnn.f64.ConvolutionLayer",
      "id": "e2d0bffa-47dc-4875-864f-3d3d000003b3",
      "isFrozen": false,
      "name": "ConvolutionLayer/e2d0bffa-47dc-4875-864f-3d3d000003b3",
      "filter": {
        "dimensions": [
          1,
          1,
          4
        ],
        "data": [
          1.68,
          1.972,
          -0.26,
          0.276
        ]
      },
      "strideX": 1,
      "strideY": 1
    }
```



### Example Input/Output Pair
Code from [LayerTestBase.java:121](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L121) executed in 0.00 seconds: 
```java
    SimpleEval eval = SimpleEval.run(layer, inputPrototype);
    return String.format("--------------------\nInput: \n[%s]\n--------------------\nOutput: \n%s",
      Arrays.stream(inputPrototype).map(t->t.prettyPrint()).reduce((a,b)->a+",\n"+b).get(),
      eval.getOutput().prettyPrint());
```

Returns: 

```
    --------------------
    Input: 
    [[
    	[ [ -0.904, -0.452 ], [ -1.336, -1.88 ], [ -1.728, -0.188 ] ],
    	[ [ 1.452, -0.628 ], [ -1.66, -0.296 ], [ 0.532, -0.62 ] ],
    	[ [ 1.18, 1.492 ], [ -1.904, -0.18 ], [ 0.576, -1.892 ] ]
    ]]
    --------------------
    Output: 
    [
    	[ [ -1.4012, -1.90744 ], [ -1.7556800000000004, -3.1534720000000003 ], [ -2.85416, -3.459504 ] ],
    	[ [ 2.6026399999999996, 2.6900159999999995 ], [ -2.7118399999999996, -3.355216 ], [ 1.05496, 0.877984 ] ],
    	[ [ 1.5944799999999997, 2.738752 ], [ -3.1519199999999996, -3.8043679999999997 ], [ 1.4595999999999998, 0.61368 ] ]
    ]
```



### Reference Implementation
Code from [LayerTestBase.java:132](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L132) executed in 0.01 seconds: 
```java
    System.out.println(new GsonBuilder().setPrettyPrinting().create().toJson(referenceLayer.getJson()));
    getEquivalencyTester().test(referenceLayer, layer, inputPrototype);
```
Logging: 
```
    {
      "class": "com.simiacryptus.mindseye.layers.aparapi.ConvolutionLayer",
      "id": "e2d0bffa-47dc-4875-864f-3d3d000003ba",
      "isFrozen": false,
      "name": "ConvolutionLayer/e2d0bffa-47dc-4875-864f-3d3d000003ba",
      "filter": {
        "dimensions": [
          1,
          1,
          4
        ],
        "data": [
          1.68,
          1.972,
          -0.26,
          0.276
        ]
      },
      "skip": {
        "dimensions": [
          1,
          1
        ]
      },
      "simple": true
    }
    Inputs: [
    	[ [ -0.904, -0.452 ], [ -1.336, -1.88 ], [ -1.728, -0.188 ] ],
    	[ [ 1.452, -0.628 ], [ -1.66, -0.296 ], [ 0.532, -0.62 ] ],
    	[ [ 1.18, 1.492 ], [ -1.904, -0.18 ], [ 0.576, -1.892 ] ]
    ]
    Error: [
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0 ], [ 0.0, 0.0 ], [ 0.0, 0.0 ] ]
    ]
    Accuracy:
    absoluteTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (18#)
    relativeTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (18#)
    
```

### Differential Validation
Code from [LayerTestBase.java:139](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L139) executed in 0.12 seconds: 
```java
    getDerivativeTester().test(layer, inputPrototype);
```
Logging: 
```
    Feedback for input 0
    Inputs: [
    	[ [ -0.904, -0.452 ], [ -1.336, -1.88 ], [ -1.728, -0.188 ] ],
    	[ [ 1.452, -0.628 ], [ -1.66, -0.296 ], [ 0.532, -0.62 ] ],
    	[ [ 1.18, 1.492 ], [ -1.904, -0.18 ], [ 0.576, -1.892 ] ]
    ]
    Output: [
    	[ [ -1.4012, -1.90744 ], [ -1.7556800000000004, -3.1534720000000003 ], [ -2.85416, -3.459504 ] ],
    	[ [ 2.6026399999999996, 2.6900159999999995 ], [ -2.7118399999999996, -3.355216 ], [ 1.05496, 0.877984 ] ],
    	[ [ 1.5944799999999997, 2.738752 ], [ -3.1519199999999996, -3.8043679999999997 ], [ 1.4595999999999998, 0.61368 ] ]
    ]
    Measured: [ [ 1.6800000000016801, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.9719999999989746 ], [ 0.0, 1.6799999999994597, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 1.6800000000016801, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 1.6800000000039006, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 1.6799999999994597, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 1.6799999999994597, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.6799999999994597, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.6799999999994597, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.6799999999994597, 0.0 ], [ -0.26000000000081513, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2759999999990548 ] ]
    Implemented: [ [ 1.68, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.972 ], [ 0.0, 1.68, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 1.68, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 1.68, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 1.68, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 1.68, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.68, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.68, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.68, 0.0 ], [ -0.26, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.276 ] ]
    Error: [ [ 1.680211525467712E-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0254019855437946E-12 ], [ 0.0, -5.402345237826012E-13, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0
```
...[skipping 745 bytes](etc/1.txt)...
```
     0.532, -0.62 ] ],
    	[ [ 1.18, 1.492 ], [ -1.904, -0.18 ], [ 0.576, -1.892 ] ]
    ]
    Outputs: [
    	[ [ -1.4012, -1.90744 ], [ -1.7556800000000004, -3.1534720000000003 ], [ -2.85416, -3.459504 ] ],
    	[ [ 2.6026399999999996, 2.6900159999999995 ], [ -2.7118399999999996, -3.355216 ], [ 1.05496, 0.877984 ] ],
    	[ [ 1.5944799999999997, 2.738752 ], [ -3.1519199999999996, -3.8043679999999997 ], [ 1.4595999999999998, 0.61368 ] ]
    ]
    Measured Gradient: [ [ -0.9039999999993498, 1.4519999999995647, 1.180000000000625, -1.3359999999984495, -1.660000000001105, -1.90400000000146, -1.72800000000084, 0.5319999999997549, 0.5760000000010201, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.9039999999993498 ], [ -0.4519999999996749, -0.6279999999980745, 1.492000000000715, -1.8799999999985495, -0.2959999999996299, -0.18000000000295557, -0.18799999999874473, -0.6199999999978445, -1.8919999999988946, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.4519999999996749 ] ]
    Implemented Gradient: [ [ -0.904, 1.452, 1.18, -1.336, -1.66, -1.904, -1.728, 0.532, 0.576, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.904 ], [ -0.452, -0.628, 1.492, -1.88, -0.296, -0.18, -0.188, -0.62, -1.892, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.452 ] ]
    Error: [ [ 6.502576255229542E-13, -4.3520742565306136E-13, 6.250555628639631E-13, 1.5505374761914936E-12, -1.1051159987118808E-12, -1.4601653219870059E-12, -8.399947404313934E-13, -2.4513724383723456E-13, 1.0201839373280563E-12, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6.502576255229542E-13 ], [ 3.251288127614771E-13, 1.925459791607409E-12, 7.149836278586008E-13, 1.4503953593703045E-12, 3.7009284525879593E-13, -2.9555802250058605E-12, 1.2552736627924332E-12, 2.1554980023097414E-12, 1.1053380433168059E-12, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.251288127614771E-13 ] ]
    Finite-Difference Derivative Accuracy:
    absoluteTol: 2.1511e-13 +- 5.8192e-13 [0.0000e+00 - 4.0057e-12] (396#)
    relativeTol: 1.1230e-12 +- 1.3916e-12 [1.2910e-15 - 8.2099e-12] (72#)
    
```

### Performance
Code from [LayerTestBase.java:144](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L144) executed in 0.42 seconds: 
```java
    getPerformanceTester().test(layer, inputPrototype);
```
Logging: 
```
    Evaluation performance: 9.8495 +- 0.8638 [8.7061 - 12.9665]
    Learning performance: 19.8615 +- 117.6836 [5.7566 - 1190.6816]
    
```

