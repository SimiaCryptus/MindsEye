# ConvolutionLayer
## IrregularTest
### Json Serialization
Code from [StandardLayerTests.java:68](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L68) executed in 0.00 seconds: 
```java
    JsonObject json = layer.getJson();
    NNLayer echo = NNLayer.fromJson(json);
    if ((echo == null)) throw new AssertionError("Failed to deserialize");
    if ((layer == echo)) throw new AssertionError("Serialization did not copy");
    if ((!layer.equals(echo))) throw new AssertionError("Serialization not equal");
    return new GsonBuilder().setPrettyPrinting().create().toJson(json);
```

Returns: 

```
    {
      "class": "com.simiacryptus.mindseye.layers.cudnn.ConvolutionLayer",
      "id": "c745eeab-d4f7-40ea-99d9-110409377c53",
      "isFrozen": false,
      "name": "ConvolutionLayer/c745eeab-d4f7-40ea-99d9-110409377c53",
      "filter": [
        [
          [
            0.916,
            0.824,
            1.656
          ],
          [
            -0.68,
            -1.28,
            0.548
          ],
          [
            0.304,
            0.888,
            1.176
          ]
        ],
        [
          [
            -1.896,
            -0.012,
            -0.212
          ],
          [
            -1.204,
            1.524,
            -1.512
          ],
          [
            1.064,
            1.24,
            0.704
          ]
        ],
        [
          [
            0.14,
            0.564,
            -0.192
          ],
          [
            1.816,
            0.536,
            0.344
          ],
          [
            -0.772,
            0.936,
            -1.12
          ]
        ],
        [
          [
            -1.396,
            0.196,
            -1.56
          ],
          [
            0.852,
            1.148,
            0.268
          ],
          [
            0.944,
            -0.532,
            1.968
          ]
        ],
        [
          [
     
```
...[skipping 5135 bytes](etc/57.txt)...
```
        [
            -1.548,
            -0.264,
            -1.096
          ],
          [
            0.576,
            -1.66,
            -1.424
          ],
          [
            1.16,
            -0.272,
            -1.656
          ]
        ],
        [
          [
            0.316,
            -0.148,
            -1.088
          ],
          [
            -0.592,
            1.044,
            1.872
          ],
          [
            1.748,
            1.376,
            -0.96
          ]
        ],
        [
          [
            -0.508,
            1.044,
            -0.468
          ],
          [
            -0.836,
            1.528,
            -0.7
          ],
          [
            0.116,
            -1.608,
            1.268
          ]
        ],
        [
          [
            -1.284,
            1.364,
            0.028
          ],
          [
            -0.724,
            -1.576,
            0.868
          ],
          [
            -0.264,
            -0.068,
            1.436
          ]
        ],
        [
          [
            -1.692,
            -0.528,
            0.392
          ],
          [
            0.216,
            0.524,
            -1.076
          ],
          [
            0.828,
            -1.884,
            -1.164
          ]
        ]
      ],
      "strideX": 1,
      "strideY": 1
    }
```



### Example Input/Output Pair
Code from [StandardLayerTests.java:152](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L152) executed in 0.00 seconds: 
```java
    SimpleEval eval = SimpleEval.run(layer, inputPrototype);
    return String.format("--------------------\nInput: \n[%s]\n--------------------\nOutput: \n%s\n--------------------\nDerivative: \n%s",
      Arrays.stream(inputPrototype).map(t -> t.prettyPrint()).reduce((a, b) -> a + ",\n" + b).get(),
      eval.getOutput().prettyPrint(),
      Arrays.stream(eval.getDerivative()).map(t -> t.prettyPrint()).reduce((a, b) -> a + ",\n" + b).get());
```

Returns: 

```
    --------------------
    Input: 
    [[
    	[ [ -0.336, 1.056, -0.168, 1.04, 1.412, 0.412, -1.452 ], [ -0.108, 1.236, 0.448, -0.62, 1.552, 1.824, -1.348 ], [ -0.744, -0.292, -1.328, -1.176, -1.912, -0.84, -0.856 ], [ 0.216, -0.784, 1.944, -0.708, -0.788, -1.756, 0.416 ], [ 0.4, 1.104, -1.968, -0.464, -1.844, -0.576, -1.072 ] ],
    	[ [ -1.912, 1.24, 0.6, 0.34, -1.648, -0.4, -1.128 ], [ 1.072, -0.9, 0.364, -1.06, 0.736, -0.836, -1.264 ], [ 1.544, 1.788, -0.188, 1.324, -0.696, -0.76, -1.584 ], [ 1.756, 1.956, -1.252, 0.156, -0.448, 0.38, 1.312 ], [ 1.94, 1.056, 0.2, 1.756, -1.94, -1.984, 1.916 ] ],
    	[ [ -1.948, 0.496, -1.796, -1.464, 1.188, 1.892, -0.144 ], [ -0.952, -0.54, 1.396, -1.896, 0.936, 0.812, 0.268 ], [ 1.22, -1.5, -0.456, -0.596, 1.004, -0.756, -1.66 ], [ -0.508, 0.2, 0.336, 1.008, 1.732, -0.184, 1.276 ], [ 1.536, 1.468, -1.38, -0.604, -1.444, 1.64, 1.244 ] ],
    	[ [ -1.836, -1.504, 1.52, -0.956, -0.38, -1.8, -0.172 ], [ 0.136, -0.132, -0.044, -0.768, -0.644, 0.684, -1.776 ], [ 1.764, 0.524, 0.068, 0.888, 1.756, -1.
```
...[skipping 4420 bytes](etc/58.txt)...
```
    -1.9040000000000004 ], [ 3.2839999999999994, 7.74, -9.604000000000003, 8.92, 3.388000000000001, -14.752, -7.384000000000001 ], [ 3.2840000000000003, 7.740000000000001, -9.604000000000001, 8.92, 3.388, -14.752, -7.384000000000001 ], [ 3.2840000000000003, 7.739999999999999, -9.604000000000001, 8.92, 3.388000000000001, -14.752, -7.384000000000003 ], [ -2.1199999999999997, 4.18, -5.912000000000001, 4.4, 8.008000000000001, -10.976, -7.44 ] ],
    	[ [ 6.764, 1.6000000000000005, -5.732000000000001, 6.119999999999999, 4.288, -2.34, -0.368000000000001 ], [ 5.4559999999999995, 4.756, -7.460000000000002, 6.895999999999999, 3.1320000000000006, -7.571999999999999, -3.6160000000000014 ], [ 5.4559999999999995, 4.756, -7.460000000000001, 6.895999999999999, 3.1320000000000006, -7.571999999999999, -3.6160000000000005 ], [ 5.456, 4.756, -7.460000000000001, 6.895999999999999, 3.1320000000000006, -7.571999999999999, -3.6160000000000005 ], [ 1.036, 3.348, -4.652000000000001, 1.9959999999999998, 5.804000000000001, -7.116, -4.748 ] ]
    ]
```



[GPU Log](etc/cuda.log)

### Reference Implementation
Code from [StandardLayerTests.java:92](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L92) executed in 0.02 seconds: 
```java
    System.out.println(new GsonBuilder().setPrettyPrinting().create().toJson(referenceLayer.getJson()));
    getEquivalencyTester().test(referenceLayer, layer, inputPrototype);
```
Logging: 
```
    {
      "class": "com.simiacryptus.mindseye.layers.aparapi.ConvolutionLayer",
      "id": "928a5496-4a57-4ca9-8fd9-1bc0aee6dc3b",
      "isFrozen": false,
      "name": "ConvolutionLayer/928a5496-4a57-4ca9-8fd9-1bc0aee6dc3b",
      "filter": [
        [
          [
            0.916,
            0.824,
            1.656
          ],
          [
            -0.68,
            -1.28,
            0.548
          ],
          [
            0.304,
            0.888,
            1.176
          ]
        ],
        [
          [
            -1.896,
            -0.012,
            -0.212
          ],
          [
            -1.204,
            1.524,
            -1.512
          ],
          [
            1.064,
            1.24,
            0.704
          ]
        ],
        [
          [
            0.14,
            0.564,
            -0.192
          ],
          [
            1.816,
            0.536,
            0.344
          ],
          [
            -0.772,
            0.936,
            -1.12
          ]
        ],
        [
          [
            -1.396,
            0.196,
            -1.56
          ],
          [
            0.852,
            1.148,
            0.268
          ],
          [
            0.944,
            -0.532,
            1.968
          ]
        ],
        [
          [
```
...[skipping 7487 bytes](etc/59.txt)...
```
    -0.244, -1.716, 1.832, 0.828, 1.924, 0.148, 1.184 ], [ 0.092, 0.144, -1.024, 1.108, 1.968, 1.2, 1.14 ] ]
    ]
    Error: [
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ] ],
    	[ [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0, 0.0 ] ]
    ]
    Accuracy:
    absoluteTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (125#)
    relativeTol: 0.0000e+00 +- 0.0000e+00 [0.0000e+00 - 0.0000e+00] (125#)
    
```

### Batch Execution
Code from [StandardLayerTests.java:101](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L101) executed in 0.02 seconds: 
```java
    return getBatchingTester().test(layer, inputPrototype);
```

Returns: 

```
    ToleranceStatistics{absoluteTol=3.2641e-17 +- 2.4938e-16 [0.0000e+00 - 3.5527e-15] (3000#), relativeTol=2.2615e-18 +- 1.6561e-17 [0.0000e+00 - 3.0169e-16] (3000#)}
```



### Differential Validation
Code from [StandardLayerTests.java:109](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L109) executed in 1.07 seconds: 
```java
    return getDerivativeTester().test(layer, inputPrototype);
```
Logging: 
```
    Inputs: [
    	[ [ 1.224, 1.92, -0.664, -1.764, -1.328, 1.656, 0.164 ], [ 1.24, 0.332, 1.08, 0.392, -1.52, 1.688, -0.128 ], [ 0.304, -1.32, -1.2, -1.624, -0.612, -1.008, -1.5 ], [ -1.068, 1.144, 1.62, -1.372, -1.5, -1.072, -0.996 ], [ -1.112, -0.668, 1.844, -0.596, 1.756, 1.96, 0.14 ] ],
    	[ [ 0.328, 0.984, 1.172, -0.112, -1.236, -0.964, -0.936 ], [ -1.712, -0.004, 1.844, -0.504, 1.192, -0.856, -0.516 ], [ 0.02, -1.064, 1.58, 1.572, -0.496, -0.448, 1.372 ], [ -1.244, -0.736, -0.588, -1.04, -1.332, -0.032, 0.276 ], [ 1.592, -1.956, -0.88, -0.324, 1.432, -0.736, -1.768 ] ],
    	[ [ 0.372, -1.9, -0.776, 0.012, -0.268, 1.54, 1.004 ], [ 0.72, -1.892, -1.02, 1.692, -1.248, 1.676, 0.172 ], [ -1.76, 0.42, 1.984, -1.288, -1.804, -0.152, 1.008 ], [ 1.896, -1.648, -1.592, 1.044, -0.948, -1.036, 0.14 ], [ -0.428, 0.724, 1.188, 1.356, -0.436, -0.812, 0.52 ] ],
    	[ [ 0.612, 0.504, -0.184, -0.924, -0.452, -1.864, -1.64 ], [ -0.6, -1.444, 0.856, -1.86, -0.396, 0.392, -1.12 ], [ -1.524, 0.016, -0.156, 1.488, 0.02, -1.32, 1.908 ], [ 1.
```
...[skipping 10911 bytes](etc/60.txt)...
```
    -11, 4.9510395783158856E-12, ... ], [ -1.36528566230254E-11, -3.890832100950092E-12, -4.846012480186346E-12, -6.8264283115127E-12, -4.07562872339895E-12, -4.310996004619483E-12, 1.294275797647515E-11, 1.1822320900023442E-11, ... ], [ 0.0, 4.110711770977105E-12, -3.890832100950092E-12, -4.846012480186346E-12, -6.8264283115127E-12, 0.0, 1.3452572389383022E-11, 1.294275797647515E-11, ... ], [ 0.0, 0.0, 0.0, 0.0, 0.0, -3.890832100950092E-12, 1.2917555913816159E-11, -6.8264283115127E-12, ... ], [ 0.0, 0.0, 0.0, 0.0, 0.0, -1.36528566230254E-11, 1.3872736293052412E-11, -4.846012480186346E-12, ... ], ... ]
    Error Statistics: {meanExponent=-11.474958869462055, negative=2894, min=1.7255086248724183E-12, max=1.7255086248724183E-12, mean=-3.9789248174930294E-14, count=39375.0, positive=3001, stdDev=3.0124848518749192E-12, zeros=33480}
    Finite-Difference Derivative Accuracy:
    absoluteTol: 1.0957e-12 +- 3.2377e-12 [0.0000e+00 - 3.4862e-11] (61250#)
    relativeTol: 1.3799e-11 +- 8.7895e-11 [2.4328e-15 - 3.0387e-09] (11810#)
    
```

Returns: 

```
    ToleranceStatistics{absoluteTol=1.0957e-12 +- 3.2377e-12 [0.0000e+00 - 3.4862e-11] (61250#), relativeTol=1.3799e-11 +- 8.7895e-11 [2.4328e-15 - 3.0387e-09] (11810#)}
```



### Performance
Code from [StandardLayerTests.java:119](../../../../../../../../src/main/java/com/simiacryptus/mindseye/test/StandardLayerTests.java#L119) executed in 1.59 seconds: 
```java
    getPerformanceTester().test(layer, permPrototype);
```
Logging: 
```
    100 batches
    Input Dimensions:
    	[100, 100, 7]
    Performance:
    	Evaluation performance: 0.074078s +- 0.014685s [0.051950s - 0.092437s]
    	Learning performance: 0.175537s +- 0.073269s [0.126875s - 0.318038s]
    
```

