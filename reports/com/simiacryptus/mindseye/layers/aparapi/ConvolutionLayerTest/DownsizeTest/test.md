# ConvolutionLayer
## DownsizeTest
### Json Serialization
Code from [LayerTestBase.java:84](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L84) executed in 0.00 seconds: 
```java
    JsonObject json = layer.getJson();
    NNLayer echo = NNLayer.fromJson(json);
    assert (echo != null) : "Failed to deserialize";
    assert (layer != echo) : "Serialization did not copy";
    Assert.assertEquals("Serialization not equal", layer, echo);
    return new GsonBuilder().setPrettyPrinting().create().toJson(json);
```

Returns: 

```
    {
      "class": "com.simiacryptus.mindseye.layers.aparapi.ConvolutionLayer",
      "id": "c88cbdf1-1c2a-4a5e-b964-890900000002",
      "isFrozen": false,
      "name": "ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-890900000002",
      "filter": {
        "dimensions": [
          3,
          3,
          21
        ],
        "data": [
          0.164,
          1.756,
          1.116,
          -1.004,
          -0.116,
          1.8,
          -0.756,
          0.756,
          1.26,
          -1.248,
          -0.348,
          1.556,
          -0.352,
          0.964,
          -1.544,
          1.844,
          0.228,
          -0.964,
          -1.932,
          0.636,
          1.504,
          0.224,
          -1.712,
          -1.632,
          1.896,
          -0.076,
          1.876,
          0.564,
          1.508,
          1.912,
          0.528,
          -0.204,
          -0.78,
          -1.56,
          0.124,
          0.892,
          -0.728,
          1.06,
          -1.62,
          0.372,
          0.352,
          -0.248,
          -0.356,
          0.9,
          1.568,
          -0.4,
          -0.708,
          0.812,
          1.144,
          0.876,
          -0.868,
          1.52,
          0.96,
          -0.688,
          0.504,
          0.944,
          0.976,
          1.532,
          0.32,
          -1.516,
          0.848,
          -0.208,
          -0.18,
          -0.22,
          -0.704,
          -1.72,
          0.676,
          0.68,
          -1.672,
          -1.92,
          0.744,
          -0.844,
          -1.492,
          0.98,
          1.9,
          0.812,
          -0.376,
          1.736,
          1.012,
          -1.148,
          -1.736,
          -0.092,
          -0.668,
          -0.284,
          -1.86,
          -1.328,
          0.196,
          -0.396,
          0.888,
          -0.824,
          0.0,
          0.248,
          -0.524,
          0.568,
          0.92,
          -0.72,
          0.896,
          -1.804,
          1.532,
          0.512,
          0.88,
          0.168,
          -1.656,
          -0.1,
          -0.224,
          -0.24,
          -1.664,
          0.596,
          -0.136,
          0.052,
          0.3,
          1.496,
          -0.64,
          -0.092,
          -1.152,
          1.5,
          0.876,
          1.012,
          -0.616,
          -0.316,
          -1.152,
          1.492,
          -0.328,
          1.5,
          -0.352,
          1.648,
          -1.992,
          1.128,
          -1.696,
          1.52,
          1.948,
          -1.752,
          -0.264,
          0.908,
          1.72,
          1.396,
          0.94,
          -0.536,
          1.804,
          -1.272,
          0.72,
          -0.244,
          -1.296,
          -0.612,
          -1.208,
          -0.036,
          -0.988,
          1.528,
          1.848,
          -1.972,
          1.4,
          -1.8,
          -0.092,
          -0.924,
          -0.792,
          1.352,
          -0.004,
          1.4,
          -0.16,
          1.0,
          1.72,
          0.464,
          -1.516,
          1.236,
          -1.528,
          1.92,
          1.424,
          -1.932,
          -0.852,
          1.172,
          0.092,
          1.352,
          -0.556,
          0.296,
          1.612,
          -1.008,
          -0.46,
          1.928,
          0.996,
          -0.112,
          -1.928,
          -0.664,
          0.896,
          0.916,
          1.896,
          -0.604,
          -0.828,
          0.992,
          -1.5
        ]
      },
      "skip": {
        "dimensions": [
          1,
          1
        ]
      },
      "simple": false
    }
```



### Example Input/Output Pair
Code from [LayerTestBase.java:121](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L121) executed in 0.01 seconds: 
```java
    SimpleEval eval = SimpleEval.run(layer, inputPrototype);
    return String.format("--------------------\nInput: \n[%s]\n--------------------\nOutput: \n%s",
      Arrays.stream(inputPrototype).map(t->t.prettyPrint()).reduce((a,b)->a+",\n"+b).get(),
      eval.getOutput().prettyPrint());
```

Returns: 

```
    --------------------
    Input: 
    [[
    	[ [ 0.376, 1.3, -0.896, -1.448, -1.488, 1.272, 1.58 ], [ -0.036, -0.932, 1.66, 1.064, -0.548, 1.82, -0.992 ], [ 1.644, 0.868, -1.632, -1.88, -1.896, -1.552, -0.34 ] ],
    	[ [ -1.3, -0.132, -0.252, -1.54, -1.564, 0.256, 1.44 ], [ 1.136, 1.596, 0.444, 1.476, 0.192, -0.552, -0.784 ], [ -1.844, -1.72, -0.024, 0.176, 0.632, -0.68, -0.056 ] ],
    	[ [ 0.176, 1.884, 0.156, -1.648, -1.564, 1.592, -0.204 ], [ -0.16, 1.132, 0.196, -1.548, -1.072, -1.896, 0.2 ], [ -0.304, 1.928, -1.072, -1.896, -1.836, 1.06, -1.988 ] ]
    ]]
    --------------------
    Output: 
    [
    	[ [ 0.05929599999999974, -2.1247999999999996, -1.9084480000000001 ] ]
    ]
```



### Differential Validation
Code from [LayerTestBase.java:139](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L139) executed in 1.09 seconds: 
```java
    getDerivativeTester().test(layer, inputPrototype);
```
Logging: 
```
    Component: ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-890900000002
    Inputs: [
    	[ [ 0.376, 1.3, -0.896, -1.448, -1.488, 1.272, 1.58 ], [ -0.036, -0.932, 1.66, 1.064, -0.548, 1.82, -0.992 ], [ 1.644, 0.868, -1.632, -1.88, -1.896, -1.552, -0.34 ] ],
    	[ [ -1.3, -0.132, -0.252, -1.54, -1.564, 0.256, 1.44 ], [ 1.136, 1.596, 0.444, 1.476, 0.192, -0.552, -0.784 ], [ -1.844, -1.72, -0.024, 0.176, 0.632, -0.68, -0.056 ] ],
    	[ [ 0.176, 1.884, 0.156, -1.648, -1.564, 1.592, -0.204 ], [ -0.16, 1.132, 0.196, -1.548, -1.072, -1.896, 0.2 ], [ -0.304, 1.928, -1.072, -1.896, -1.836, 1.06, -1.988 ] ]
    ]
    output=[
    	[ [ 0.05929599999999974, -2.1247999999999996, -1.9084480000000001 ] ]
    ]
    measured/actual: [ [ 0.1639999999980546, -1.24800000000036, -1.9320000000000448 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.5640000000006751, -0.7279999999987297, -0.4000000000026205 ] ]
    implemented/expected: [ [ 0.164, -1.248, -1.932 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.564, -0.728, -0.4 ] ]
    error: [ [ -1.945416050475046E-12, -3.5993430458347575E-13, -4.4853010194856324E-14 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 6.751266212745577E-13, 1.2703171847761041E-12, -2.620459405022757E-12 ] ]
    Component: ConvolutionLayer/c88cbdf1-1c2a-4a5e-b964-890900000002
    Inputs: [
    	[ [ 0.376, 1.3, -0.896, -1.448, -1.488, 1.272, 1.58 ], [ -0.036, -0.932, 1.66, 1.064, -0.548, 1.82, -0.992 ], [ 1.644, 0.868, -1.632, -1.88, -1.896, -1.552, -0.34 ] ],
    	[ [ -1.3, -0.132, -0.252, -1.54, -1.564, 0.256, 1.44 ], [ 1.136, 1.596, 0.444, 1.476, 0.192, -0.552, -0.784 ], [ -1.844, -1.72, -0.024, 0.176, 0.632, -0.68, -0.056 ] ],
    	[ [ 0.176, 1.884, 0.156, -1.648, -1.564, 1.592, -0.204 ], [ -0.16, 1.132, 0.196, -1.548, -1.072, -1.896, 0.2 ], [ -0.304, 1.928, -1.072, -1.896, -1.836, 1.06, -1.988 ] ]
    ]
    Outputs: [
    	[ [ 0.05929599999999974, -2.1247999999999996, -1.9084480000000001 ] ]
    ]
    Measured Gradient: [ [ 0.37600000000193035, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.37599999999748945, 0.0 ] ]
    Implemented Gradient: [ [ 0.376, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.376, 0.0 ] ]
    Error: [ [ 1.9303447729157597E-12, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0 ], [ 0.0, -2.5105473255848665E-12, 0.0 ] ]
    Finite-Difference Derivative Accuracy:
    absoluteTol: 8.0831e-14 +- 4.3873e-13 [0.0000e+00 - 4.8062e-12] (756#)
    relativeTol: 1.2604e-12 +- 1.7575e-12 [1.1608e-14 - 9.3314e-12] (41#)
    
```

### Performance
Code from [LayerTestBase.java:144](../../../../../../../../../MindsEye/src/test/java/com/simiacryptus/mindseye/layers/LayerTestBase.java#L144) executed in 0.78 seconds: 
```java
    getPerformanceTester().test(layer, inputPrototype);
```
Logging: 
```
    Evaluation performance: 27.9225 +- 2.9938 [24.4825 - 40.8147]
    Learning performance: 20.4790 +- 2.1732 [18.4980 - 35.0553]
    
```

